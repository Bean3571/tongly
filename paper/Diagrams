#####################BACKEND

@startuml
!theme spacelab
skinparam packageBorderColor #90a4ae
skinparam packageBackgroundColor #fafafa
skinparam ArrowThickness 2

package "Входная точка" {
  [server]
}

package "Инфраструктура" {
  [Config]
  [Logger]
  [Database]
}
package "Маршрутизация" {
  [Router]
}
package "Обработчики" {
  [Handlers]
}

package "Бизнес-логика" {
  [Usecases]
}

package "Доступ к данным" {
  [Repositories]
}

package "Сущности"  {
  [Entities]
}

package "Прослойка"  {
  [Middleware]
}

[server] --> [Config]
[server] --> [Logger]
[server] --> [Database]
[server] --> [Router]
[server] --> [Handlers]
[server] --> [Usecases]
[server] --> [Repositories]

[Router] --> [Middleware]
[Middleware] --> [Handlers]
[Handlers] --> [Usecases]
[Usecases] --> [Repositories]
[Repositories] --> [Entities]

@enduml


#####################FRONTEND
@startuml
!theme spacelab
skinparam packageBorderColor #90a4ae
skinparam packageBackgroundColor #fafafa
skinparam ArrowThickness 2

package "Входная точка" {
  [App]
}

package "Инфраструктура" {
  [ThemeProvider]
  [TranslationLoader]
  [AuthProvider]
}

package "Маршрутизация" {
  [AppRoutes]
}

package "Страницы" {
  [Pages]
}

package "Компоненты" {
  [Components]
}

package "Контексты" {
  [Contexts]
}

package "Сервисы" {
  [Services]
}

package "API" {
  [apiClient]
}

[App] --> [ThemeProvider]
[App] --> [TranslationLoader]
[App] --> [AuthProvider]
[App] --> [AppRoutes]

[AppRoutes] --> [Pages]
[Pages] --> [Components]
[Pages] --> [Contexts]
[Pages] --> [Services]
[Components] --> [Contexts]
[Services] --> [apiClient]
[Contexts] --> [Services]

@enduml

####################VIDEO SERVICE

@startuml
!theme spacelab
skinparam packageBorderColor #90a4ae
skinparam packageBackgroundColor #fafafa
skinparam ArrowThickness 2

package "Входная точка" {
  [server]
}

package "Инфраструктура" {
  [Config]
  [Logger]
}

package "Обработчики" {
  [Handlers]
}

package "Бизнес-логика" {
  [WebRTC]
  [Chat]
}

[server] --> [Config]
[server] --> [Logger]
[server] --> [Handlers]
[Handlers] --> [WebRTC]
[Handlers] --> [Chat]

@enduml

################JWT
@startuml
!theme plain
actor Пользователь
participant "Клиент" as FE
participant "Сервер" as BE
database "База данных"

== Аутентификация и получение JWT ==
Пользователь -> FE : Вводит логин и пароль
FE -> BE : POST /api/auth/login {логин, пароль}
BE -> "База данных" : Проверка пользователя
"База данных" --> BE : Данные пользователя
BE -> BE : Генерация JWT (id, роль, срок)
BE --> FE : {jwt}

== Хранение токена ==
FE -> FE : Сохраняет jwt в localStorage

== Использование токена при запросах ==
Пользователь -> FE : Выполняет защищённое действие \n(бронирование урока)
FE -> BE : Запрос к API (Authorization: Bearer jwt)
BE -> BE : Middleware проверяет токен, извлекает id и роль
BE -> "База данных" : Выполнение бизнес-логики (создание урока)
"База данных" --> BE : Результат
BE --> FE : Ответ с данными
FE -> Пользователь : Отображает результат
@enduml

######################STUDENT REG
@startuml
!theme plain
actor Пользователь
participant "Клиент" as FE
participant "Сервер (API)" as BE
participant "UseCase регистрации" as UC
participant "UserRepository"
participant "StudentRepository"
database "База данных"

Пользователь -> FE : Вводит данные для регистрации
FE -> BE : POST /api/auth/register \n{username, email, \npassword, role=student}
BE -> UC : Вызов RegisterStudent
UC -> UserRepository : Проверка username/email
UserRepository -> "База данных" : SELECT ... \nFROM users
"База данных" --> UserRepository : Результат
UserRepository --> UC : Результат проверки
UC -> UserRepository : Создание пользователя
UserRepository -> "База данных" : INSERT \nINTO users ...
"База данных" --> UserRepository : id пользователя
UserRepository --> UC : Новый пользователь
UC -> StudentRepository : Создание профиля ученика
StudentRepository -> "База данных" : INSERT \nINTO student_profiles ...
"База данных" --> StudentRepository : created_at,\nupdated_at
StudentRepository --> UC : Новый профиль ученика
UC --> BE : Новый пользователь\nсоздан
BE --> FE : Ответ с данными\nпользователя
FE -> Пользователь : Отображает результат
@enduml


